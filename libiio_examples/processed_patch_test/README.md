# libiio Examples - Processed Patch Test

The following example tests the patch which enables the "Processed" IIO attribute,
which is displayed as `out_voltage_input` in sysfs to explicitly transition the
IP core to DMA mode without needing to open a IIO Buffer.  This feature is
useful when designs incorporate custom data sources in the FPGA which need to
be switched in, but still want to leverage the existing DMA and DDS capabilities.

## Building
To build this application, simply run GCC while linking against libiio:

`gcc ad9081_processed_test.c -liio -o ad9081_processed_test`

*NOTE:*This application attempts to configure 8 pairs of I&Q for each Rx and Tx
data path.  The default HDL and device tree configuration in Kuiper Linux (m8_l4)
only has 4 pairs in each direction.  The NUM_CH constant can be redefined at
build time to only support the first 4 channels:

`gcc ad9081_processed_test.c -liio -DNUM_TX_CH=4 -o ad9081_processed_test`

## Expected Output
The following shows an example output when running with 4 channels:

```
$ IIOD_REMOTE=ip:192.168.1.155 ./ad9081_processed_test

main, 170: INFO: Loading Channels
Verifying Processed/Input is disabled to start...
Setting Raw = 0. Verifying Registers...
Creating a DMA buffer...
Verifying Processed/Input Locked Out...
Verifying Registers are DMA Mode...
Destroying The Buffer...
Setting Raw = 0. Verifying Registers...
Enabling Processed/Input Mode...
Verifying Registers are DMA...
Verifying RAW is locked out...
Verifying Buffers locked out...
ERROR: Open unlocked: -16
Disabling Processed/Input mode...
Verifying Registers back to DDS...
Enabling Buffers again...
Verifying Processed/Input is locked out...
Verifying Registers are DMA...
Destroying the Buffer...
Setting Raw = 1. Verifying Registers...
Enabling Processed/Input Mode...
Verifying Registers are DMA...
Verifying RAW locked out...
Verifying Buffers locked out...
ERROR: Open unlocked: -16
Disabling Processed/Input Mode...
Test Completed Successfully!
```

### A Note On Errors
In the output above, there are errors indicated by `ERROR: Open unlocked: -16`.
These are errors generated by libiio due to not being able to open a buffer.
These are expected since the buffering capability is intended to be locked out
during that operation.  To disable errors from libiio, libiio will need to be
rebuilt with LOG_LEVEL set to 0.

Actual errors in the test will be from the _error_ macro in the code, which has
a prefix of the file name, and line number, and will say Test Failure. i.e.:
`main, 229: ERROR: Test failure!`